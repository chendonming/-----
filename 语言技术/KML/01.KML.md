# 01.KML

## 第一部分：什么是 KML？

**1. 定义**
KML 全称是 **Keyhole Markup Language**。
*   **Keyhole**: 最初由 Keyhole 公司开发（这家公司后来被 Google 收购，这就是 Google Earth 的前身）。
*   **Markup Language**: 标记语言。这和我们做网页用的 HTML 很像，都是用尖括号 `< >` 把内容包起来。

**2. 作用**
简单来说，KML 就是一种**用来描述地理空间信息的文件格式**。
如果你想告诉朋友：“嘿，我在地图上的这个位置（经纬度），这里有一家好吃的餐厅（名称），它的照片是这样的（描述）”，你可以写一个 KML 文件发给他，他拖进 Google Earth 或 ArcGIS 中，就能直接看到这些信息。

**3. 标准**
现在 KML 是 **OGC**（开放地理空间联盟）的国际标准。这意味着几乎所有的 GIS 软件（Google Earth, ArcGIS, QGIS 等）都支持它。

---

## 第二部分：KML 的基本结构（语法规则）

KML 是基于 XML（可扩展标记语言）的。如果你不懂 XML 也没关系，只需要记住以下几个核心规则：

### 1. "三明治"结构
KML 就像一个层层包裹的三明治：
*   最外层是 **KML 声明**。
*   中间层是 **Document**（文档）。
*   最里层是 **Placemark**（地标，也就是具体的点、线、面）。

**一个最简单的 KML 文件示例：**

```xml
<?xml version="1.0" encoding="UTF-8"?>
<kml xmlns="http://www.opengis.net/kml/2.2">
  <Document>
    <Placemark>
      <name>我的第一个点</name>
      <description>这是我在GIS世界留下的第一个足迹。</description>
      <Point>
        <coordinates>116.397,39.907,0</coordinates>
      </Point>
    </Placemark>
  </Document>
</kml>
```

### 2. 核心标签讲解

*   **`<kml>`**: 根元素，所有内容都在这里面。
*   **`<Document>`**: 容器，用来装具体的地图要素。
*   **`<Placemark>` (重要)**: 这是 KML 的灵魂。每一个点、每一条线、每一个多边形，都是一个 Placemark。
    *   `<name>`: 在地图上显示的名称。
    *   `<description>`: 点击图标后弹出的气泡框里的文字（支持 HTML 代码，可以放图片和链接）。
    *   `<Point>`, `<LineString>`, `<Polygon>`: 定义几何形状。

---

## 第三部分：KML 的具体规则与几何类型

这是新手最容易出错的地方，请仔细阅读。

### 1. 坐标规则 (The Golden Rule)
这是 GIS 新手**最容易犯错**的地方！

在 KML 的 `<coordinates>` 标签中，坐标的顺序必须是：
**经度, 纬度, 高度**
(Longitude, Latitude, Altitude)

*   **错误习惯**：很多人习惯说“纬度、经度”（比如 39度北，116度东）。
*   **KML 规则**：**先经度(X)，后纬度(Y)**。
*   **格式**：`116.397,39.907,0` (中间用**英文逗号**隔开，**不要加空格**)。

### 2. 三种基本几何形状

**A. 点 (Point)**
用来标记位置，如学校、公交站。
```xml
<Placemark>
  <name>北京天安门</name>
  <Point>
    <coordinates>116.397499,39.907869,0</coordinates>
  </Point>
</Placemark>
```

**B. 线 (LineString)**
用来表示路径，如路线、河流。
```xml
<Placemark>
  <name>上班路线</name>
  <LineString>
    <coordinates>
      116.397,39.907,0 
      116.400,39.910,0 
      116.405,39.920,0
    </coordinates>
  </LineString>
</Placemark>
```
*注意：多个坐标点之间可以用空格或换行分隔。*

**C. 面 (Polygon)**
用来表示区域，如行政区、湖泊。
```xml
<Placemark>
  <name>故宫区域</name>
  <Polygon>
    <outerBoundaryIs>
      <LinearRing>
        <coordinates>
          116.390,39.910,0
          116.400,39.910,0
          116.400,39.920,0
          116.390,39.920,0
          116.390,39.910,0 
        </coordinates>
      </LinearRing>
    </outerBoundaryIs>
  </Polygon>
</Placemark>
```
*注意：多边形的**第一个坐标**和**最后一个坐标**必须相同（形成闭合回路）。*

---

## 第四部分：进阶一点点 —— 样式与 KMZ

### 1. 样式 (Style)
你可以改变图钉的颜色、线条的粗细、多边形的填充色。
KML 使用 `<Style>` 标签，并通过 id 来引用。

```xml
<Style id="myRedLine">
  <LineStyle>
    <color>ff0000ff</color> <!-- KML颜色代码：透明度+蓝+绿+红 (AABBGGRR) -->
    <width>4</width>
  </LineStyle>
</Style>
<Placemark>
  <styleUrl>#myRedLine</styleUrl> <!-- 引用上面的样式 -->
  ...
</Placemark>
```
*注意：KML 的颜色代码很特殊，是 **AABBGGRR**（十六进制），这和网页设计的 #RRGGBB 是反着的！*

### 2. 什么是 KMZ？
你在工作中可能会收到 `.kmz` 文件。
*   **KML**: 纯文本文件（类似于 .txt），只包含代码。
*   **KMZ**: 是 KML 的**压缩包**（类似于 .zip）。
    *   **为什么用 KMZ？** 如果你的地图里包含了自定义图标（图片）或者照片，KML 只是文本存不了图片。KMZ 把 KML 文件和相关的图片文件打包压缩在一起，方便传输。
